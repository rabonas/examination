let movies = [{
    "id": 580489,
    "poster": "/rjkmN1dniUHVYAtwuV3Tji7FsDO.jpg",
    "genres": [
        "Science Fiction",
        "Action",
        "Comedy"
    ],
    "lang": "en",
    "release_date": "2021-09-30",
    "title": "Venom: Let There Be Carnage"
},
{
    "id": 459151,
    "poster": "/uWStkK8bq9ixY3fc7y209ZleCoF.jpg",
    "genres": [
        "Animation",
        "Comedy",
        "Adventure",
        "Family"
    ],
    "lang": "en",
    "release_date": "2021-07-01",
    "title": "The Boss Baby: Family Business"
},
{
    "id": 744275,
    "poster": "/oOZITZodAja6optBgLh8ZZrgzbb.jpg",
    "genres": [
        "Romance",
        "Drama"
    ],
    "lang": "en",
    "release_date": "2021-09-01",
    "title": "After We Fell"
},
{
    "id": 565028,
    "poster": "/dqoshZPLNsXlC1qtz5n34raUyrE.jpg",
    "genres": [
        "Horror",
        "Thriller"
    ],
    "lang": "en",
    "release_date": "2021-08-25",
    "title": "Candyman"
},
{
    "id": 588921,
    "poster": "/l8HyObVj8fPrzacAPtGWWLDhcfh.jpg",
    "genres": [
        "Adventure",
        "Animation",
        "Family",
        "Fantasy"
    ],
    "lang": "en",
    "release_date": "2021-02-09",
    "title": "Ainbo: Spirit of the Amazon"
},
{
    "id": 850818,
    "poster": "/8PCeAhmRkiWYLBq0quetaFrHZp3.jpg",
    "genres": [
        "Animation",
        "Music",
        "Family"
    ],
    "lang": "en",
    "release_date": "2021-08-20",
    "title": "Barbie: Big City, Big Dreams"
},
{
    "id": 370172,
    "poster": "/iUgygt3fscRoKWCV1d0C7FbM9TP.jpg",
    "genres": [
        "Adventure",
        "Action",
        "Thriller"
    ],
    "lang": "en",
    "release_date": "2021-09-29",
    "title": "No Time to Die"
},
{
    "id": 438631,
    "poster": "/s1FhMAr91WL8D5DeHOcuBELtiHJ.jpg",
    "genres": [
        "Action",
        "Adventure",
        "Science Fiction",
        "Drama"
    ],
    "lang": "en",
    "release_date": "2021-09-15",
    "title": "Dune"
},
{
    "id": 522444,
    "poster": "/95S6PinQIvVe4uJAd82a2iGZ0rA.jpg",
    "genres": [
        "Horror",
        "Thriller",
        "Adventure",
        "Mystery"
    ],
    "lang": "en",
    "release_date": "2020-07-09",
    "title": "Black Water: Abyss"
},
{
    "id": 749274,
    "poster": "/wqaaWAlXgLNGdAemU7wNvFZ70hr.jpg",
    "genres": [
        "Western",
        "Drama"
    ],
    "lang": "en",
    "release_date": "2021-09-16",
    "title": "Cry Macho"
},
{
    "id": 646207,
    "poster": "/jFaTMs1GEuSKZxUav4XECg3iGEo.jpg",
    "genres": [
        "Action",
        "Thriller"
    ],
    "lang": "en",
    "release_date": "2021-06-24",
    "title": "The Ice Road"
},
{
    "id": 610253,
    "poster": "/1hT1HXhSgLHW3XEAcsgsZNfhbiY.jpg",
    "genres": [
        "Horror",
        "Thriller",
        "Crime"
    ],
    "lang": "en",
    "release_date": "2021-10-14",
    "title": "Halloween Kills"
},
{
    "id": 523638,
    "poster": "/j5HRzcvN1QXZLvwfc3NLxX8XQJY.jpg",
    "genres": [
        "Action",
        "Horror",
        "Science Fiction",
        "Thriller"
    ],
    "lang": "en",
    "release_date": "2021-08-31",
    "title": "Prisoners of the Ghostland"
},
{
    "id": 639721,
    "poster": "/ld7YB9vBRp1GM1DT3KmFWSmtBPB.jpg",
    "genres": [
        "Animation",
        "Comedy",
        "Family"
    ],
    "lang": "en",
    "release_date": "2021-10-01",
    "title": "The Addams Family 2"
},
{
    "id": 630004,
    "poster": "/iiHubBBVFg6K7t5THdsImqy1ct2.jpg",
    "genres": [
        "Crime",
        "Action",
        "Thriller"
    ],
    "lang": "en",
    "release_date": "2021-03-03",
    "title": "The Vault"
},
{
    "id": 629992,
    "poster": "/eCGtHjsGSdXPhb8fw6Pl825Cb0R.jpg",
    "genres": [
        "Documentary"
    ],
    "lang": "en",
    "release_date": "2021-09-29",
    "title": "Oliver Sacks: His Own Life"
},
{
    "id": 589761,
    "poster": "/kfQJQWFEoWRVBH8FUKnT0HX1yRS.jpg",
    "genres": [
        "Drama",
        "History",
        "Adventure"
    ],
    "lang": "ru",
    "release_date": "2021-04-15",
    "title": "Chernobyl 1986"
},
{
    "id": 72213,
    "poster": "/CkwRzUmxvMZvkzzGE45nqLGTm8.jpg",
    "genres": [
        "Drama"
    ],
    "lang": "en",
    "release_date": "2011-09-30",
    "title": "Courageous"
},
{
    "id": 617653,
    "poster": "/j5lQ9aDbal3C9I8AOWEwxstGzx6.jpg",
    "genres": [
        "Drama",
        "History"
    ],
    "lang": "en",
    "release_date": "2021-10-13",
    "title": "The Last Duel"
},
{
    "id": 565470,
    "poster": "/kFQwRGFQtxW67Cj5tRSGyownMz.jpg",
    "genres": [
        "Drama",
        "History"
    ],
    "lang": "en",
    "release_date": "2021-09-30",
    "title": "Roe v. Wade"
},
{
    "id": 714011,
    "poster": "/mXaNg69iWEs0Qsj4AJxcvCXuWKw.jpg",
    "genres": [
        "Drama"
    ],
    "lang": "en",
    "release_date": "2021-09-29",
    "title": "After Love"
},
{
    "id": 861589,
    "poster": "/xo0eJXRtAnUEQrOPi9A88GMKd6u.jpg",
    "genres": [
        "Drama",
        "Romance",
        "Comedy"
    ],
    "lang": "fr",
    "release_date": "2021-09-29",
    "title": "Guermantes"
},
{
    "id": 524369,
    "poster": "/vVVi28ogw01NS117HU8fdgeiG8N.jpg",
    "genres": [
        "Drama",
        "Crime"
    ],
    "lang": "en",
    "release_date": "2021-09-22",
    "title": "The Many Saints of Newark"
},
{
    "id": 642208,
    "poster": "/l5n8Qb5Vm01s8UdqI6Brf0J4j6W.jpg",
    "genres": [
        "Drama",
        "Romance"
    ],
    "lang": "en",
    "release_date": "2021-01-29",
    "title": "Supernova"
},
{
    "id": 660334,
    "poster": "/djPSAYDuxhJHAsoFVAeDQGU688b.jpg",
    "genres": [
        "Drama"
    ],
    "lang": "fr",
    "release_date": "2021-09-29",
    "title": "Arthur Rambo"
},
{
    "id": 18491,
    "poster": "/m9PTii0XWCIKZBBrCrOn8RLTK0w.jpg",
    "genres": [
        "Drama",
        "Science Fiction",
        "Animation",
        "Action"
    ],
    "lang": "ja",
    "release_date": "1997-07-19",
    "title": "Neon Genesis Evangelion: The End of Evangelion"
},
{
    "id": 661595,
    "poster": "/1gTnopPJgauN46CYGobPyZCZQTn.jpg",
    "genres": [
        "Action",
        "Crime",
        "Thriller"
    ],
    "lang": "pt",
    "release_date": "2021-08-26",
    "title": "Yakuza Princess"
},
{
    "id": 630240,
    "poster": "/lubDkWllPr0Susbv0K4oMGuOiLg.jpg",
    "genres": [
        "Drama",
        "Horror",
        "Thriller"
    ],
    "lang": "fr",
    "release_date": "2021-07-14",
    "title": "Titane"
},
{
    "id": 441130,
    "poster": "/ehAKuE48okTuonq6TpsNQj8vFTC.jpg",
    "genres": [
        "Animation",
        "Family",
        "Adventure",
        "Fantasy"
    ],
    "lang": "en",
    "release_date": "2020-10-26",
    "title": "Wolfwalkers"
},
{
    "id": 738652,
    "poster": "/9Se3AIepFRZ4VUaaDosADs8WMX5.jpg",
    "genres": [
        "Action",
        "Thriller",
        "Crime"
    ],
    "lang": "en",
    "release_date": "2021-09-09",
    "title": "Copshop"
},
{
    "id": 779608,
    "poster": "/gDROgOVvTf3Vsr9tXKYINwbvtnz.jpg",
    "genres": [
        "Documentary"
    ],
    "lang": "fr",
    "release_date": "2021-09-29",
    "title": "Poumon vert et tapis rouge"
},
{
    "id": 749386,
    "poster": "/3cOnZ3BEptXHoGul3wHO3hJNKR0.jpg",
    "genres": [
        "History",
        "Drama"
    ],
    "lang": "fr",
    "release_date": "2021-09-29",
    "title": "Eugénie Grandet"
},
{
    "id": 785210,
    "poster": "/aSGUly8gF8IeZ3NGPEkJ1ptuLbG.jpg",
    "genres": [
        "Comedy"
    ],
    "lang": "fr",
    "release_date": "2021-09-29",
    "title": "Love Song for Tough Guys"
},
{
    "id": 795853,
    "poster": "/v8cwfPwjHDWf5s5MxvLvcfnxPLL.jpg",
    "genres": [
        "Horror",
        "Fantasy",
        "Drama"
    ],
    "lang": "en",
    "release_date": "2021-06-18",
    "title": "Gaia"
},
{
    "id": 869525,
    "poster": "/kbchdQcRU5R3PCSet3z3u7UXzPp.jpg",
    "genres": [
        "Animation",
        "Family",
        "Comedy",
        "Adventure"
    ],
    "lang": "fr",
    "release_date": "2021-09-29",
    "title": "Les mésaventures de Joe"
},
{
    "id": 575446,
    "poster": "/v6NodCMzqilx0Xw541P65WFnDfE.jpg",
    "genres": [
        "Thriller",
        "Drama"
    ],
    "lang": "es",
    "release_date": "2020-09-10",
    "title": "New Order"
},
{
    "id": 871983,
    "poster": "/wWnt8JyG1FPfMtSEzjg8kAqGBJd.jpg",
    "genres": [
        "Thriller"
    ],
    "lang": "ko",
    "release_date": "2021-09-29",
    "title": "The Recon"
},
{
    "id": 586945,
    "poster": "/eDv3y4biYkCYHSCRXfxOFHaECwr.jpg",
    "genres": [
        "Animation",
        "Drama"
    ],
    "lang": "fr",
    "release_date": "2021-09-29",
    "title": "The Crossing"
},
{
    "id": 860732,
    "poster": "/xvCdW8iV38FjSx9SkV7R0LKvAsn.jpg",
    "genres": [
        "Drama"
    ],
    "lang": "el",
    "release_date": "2021-09-29",
    "title": "Umbilical"
},
{
    "id": 553592,
    "poster": "/peYRpielBbRHMGNYJnWyCsG7apA.jpg",
    "genres": [
        "Romance",
        "Comedy"
    ],
    "lang": "en",
    "release_date": "2021-06-11",
    "title": "Queen Bees"
},
{
    "id": 866319,
    "poster": "/aewoFzX1GO2wiwADcVnD51OPsH.jpg",
    "genres": [
        "Family"
    ],
    "lang": "nl",
    "release_date": "2021-09-29",
    "title": "Berend Botje"
},
{
    "id": 875691,
    "poster": "/26JTQF4ZmupsedmIcTaZsidk4yn.jpg",
    "genres": [
        "Animation"
    ],
    "lang": "el",
    "release_date": "2021-09-28",
    "title": "Lost and Found"
},
{
    "id": 869680,
    "poster": "/1LTjrZ8gSgBowu56DkUcYCEfbHL.jpg",
    "genres": [

    ],
    "lang": "en",
    "release_date": "2021-09-28",
    "title": "Care Package"
},
{
    "id": 779029,
    "poster": "/o0QQoZJxe1MYuHTNVbZe9K67yyS.jpg",
    "genres": [
        "Action",
        "War"
    ],
    "lang": "zh",
    "release_date": "2021-09-30",
    "title": "The Battle at Lake Changjin"
},
{
    "id": 663870,
    "poster": "/sshNnwmQLk720iBQ0dZg3GVGKfK.jpg",
    "genres": [
        "Action",
        "Comedy",
        "Drama"
    ],
    "lang": "da",
    "release_date": "2020-11-19",
    "title": "Riders of Justice"
},
{
    "id": 871693,
    "poster": "/tHsj13H6d59YY5mMWdmTW7G13gL.jpg",
    "genres": [
        "Drama"
    ],
    "lang": "nl",
    "release_date": "2021-09-29",
    "title": "Quicksand"
},
{
    "id": 482321,
    "poster": "/gA9QxSravC2EVEkEKgyEmDrfL0e.jpg",
    "genres": [
        "Animation",
        "Science Fiction",
        "Family",
        "Comedy"
    ],
    "lang": "en",
    "release_date": "2021-10-20",
    "title": "Ron's Gone Wrong"
},
{
    "id": 875433,
    "poster": "/byC2awpTpepMBb7dqatqiIvTgZR.jpg",
    "genres": [
        "Drama"
    ],
    "lang": "en",
    "release_date": "2021-09-29",
    "title": "Girlhood"
},
{
    "id": 875697,
    "poster": "/b9BALBo6G6RFfcG8C2byNQBU6wE.jpg",
    "genres": [
        "Drama"
    ],
    "lang": "el",
    "release_date": "2021-09-28",
    "title": "Alaska"
},
{
    "id": 718221,
    "poster": "/pWhpoxceQuSyashXI6tgayGgElD.jpg",
    "genres": [
        "Documentary"
    ],
    "lang": "en",
    "release_date": "2021-09-30",
    "title": "Joy Womack: The White Swan"
},
{
    "id": 786302,
    "poster": "/kvF85F5NhTtdneJPp0xfPXwrCzM.jpg",
    "genres": [
        "Thriller"
    ],
    "lang": "en",
    "release_date": "2021-09-30",
    "title": "Dead in the Water"
},
{
    "id": 711963,
    "poster": "/cSasDqt5z0iz69VqmPRdV12HCc6.jpg",
    "genres": [
        "Thriller",
        "Horror"
    ],
    "lang": "en",
    "release_date": "2021-08-12",
    "title": "Coming Home in the Dark"
},
{
    "id": 869670,
    "poster": "/eGFnbESHGTFhyPAZIhb5KLrldkT.jpg",
    "genres": [

    ],
    "lang": "de",
    "release_date": "2021-09-29",
    "title": "TrainFish"
},
{
    "id": 662708,
    "poster": "/vGcHyV9s1N2I7bJLSBODvqHTYLL.jpg",
    "genres": [
        "Adventure",
        "Animation"
    ],
    "lang": "ja",
    "release_date": "2020-12-25",
    "title": "Pokémon the Movie: Secrets of the Jungle"
},
{
    "id": 876234,
    "poster": "/1k7Nkk1kMTe423wfGv4DN1hpLft.jpg",
    "genres": [
        "Documentary"
    ],
    "lang": "uk",
    "release_date": "2021-09-29",
    "title": "Dialogues on Dignity"
},
{
    "id": 876230,
    "poster": "/2L0kydfwLdwCQ7MtRU0UWwJm0gs.jpg",
    "genres": [

    ],
    "lang": "uk",
    "release_date": "2021-09-28",
    "title": "Dogs Don't Bite Good People"
},
{
    "id": 872284,
    "poster": "/3VtEGpi2JiX3PwIzVmHBLrjhkTi.jpg",
    "genres": [
        "Comedy"
    ],
    "lang": "es",
    "release_date": "2021-09-30",
    "title": "Doblemente Embarazada"
},
{
    "id": 550988,
    "poster": "/xmbU4JTUm8rsdtn7Y3Fcm30GpeT.jpg",
    "genres": [
        "Comedy",
        "Action",
        "Adventure",
        "Science Fiction"
    ],
    "lang": "en",
    "release_date": "2021-08-11",
    "title": "Free Guy"
},
{
    "id": 568620,
    "poster": "/uIXF0sQGXOxQhbaEaKOi2VYlIL0.jpg",
    "genres": [
        "Action",
        "Adventure"
    ],
    "lang": "en",
    "release_date": "2021-07-22",
    "title": "Snake Eyes: G.I. Joe Origins"
},
{
    "id": 637534,
    "poster": "/nLanxl7Xhfbd5s8FxPy8jWZw4rv.jpg",
    "genres": [
        "Crime",
        "Thriller"
    ],
    "lang": "fr",
    "release_date": "2021-08-18",
    "title": "The Stronghold"
},
{
    "id": 566525,
    "poster": "/xeItgLK9qcafxbd8kYgv7XnMEog.jpg",
    "genres": [
        "Action",
        "Adventure",
        "Fantasy"
    ],
    "lang": "en",
    "release_date": "2021-09-01",
    "title": "Shang-Chi and the Legend of the Ten Rings"
},
{
    "id": 631843,
    "poster": "/vclShucpUmPhdAOmKgf3B3Z4POD.jpg",
    "genres": [
        "Mystery",
        "Thriller",
        "Horror"
    ],
    "lang": "en",
    "release_date": "2021-07-21",
    "title": "Old"
},
{
    "id": 589754,
    "poster": "/5VJSIAhSn4qUsg5nOj4MhQhF5wQ.jpg",
    "genres": [
        "Fantasy",
        "Adventure",
        "Comedy"
    ],
    "lang": "ru",
    "release_date": "2021-01-01",
    "title": "The Last Warrior: Root of Evil"
},
{
    "id": 859860,
    "poster": "/qKxrBZ8Ts4KHZKp7BT6GAVMLFO2.jpg",
    "genres": [
        "Western",
        "Action"
    ],
    "lang": "en",
    "release_date": "2021-09-10",
    "title": "Catch the Bullet"
},
{
    "id": 436969,
    "poster": "/kb4s0ML0iVZlG6wAKbbs9NAm6X.jpg",
    "genres": [
        "Action",
        "Adventure",
        "Fantasy",
        "Comedy"
    ],
    "lang": "en",
    "release_date": "2021-07-28",
    "title": "The Suicide Squad"
},
{
    "id": 703771,
    "poster": "/vFIHbiy55smzi50RmF8LQjmpGcx.jpg",
    "genres": [
        "Animation",
        "Action",
        "Adventure",
        "Science Fiction"
    ],
    "lang": "en",
    "release_date": "2020-08-04",
    "title": "Deathstroke: Knights & Dragons - The Movie"
},
{
    "id": 595743,
    "poster": "/6Y9fl8tD1xtyUrOHV2MkCYTpzgi.jpg",
    "genres": [
        "Action",
        "Thriller"
    ],
    "lang": "en",
    "release_date": "2021-08-11",
    "title": "SAS: Red Notice"
},
{
    "id": 597891,
    "poster": "/uJgdT1boTSP0dDIjdTgGleg71l4.jpg",
    "genres": [
        "Action",
        "Thriller"
    ],
    "lang": "en",
    "release_date": "2021-09-10",
    "title": "Kate"
},
{
    "id": 451048,
    "poster": "/9dKCd55IuTT5QRs989m9Qlb7d2B.jpg",
    "genres": [
        "Adventure",
        "Fantasy",
        "Comedy",
        "Action"
    ],
    "lang": "en",
    "release_date": "2021-07-28",
    "title": "Jungle Cruise"
},
{
    "id": 385128,
    "poster": "/bOFaAXmWWXC3Rbv4u4uM9ZSzRXP.jpg",
    "genres": [
        "Action",
        "Crime",
        "Thriller"
    ],
    "lang": "en",
    "release_date": "2021-05-19",
    "title": "F9"
},
{
    "id": 681887,
    "poster": "/6Wm7P6y22UZA40QuPYHyWyJ6leI.jpg",
    "genres": [
        "Science Fiction"
    ],
    "lang": "en",
    "release_date": "2021-03-12",
    "title": "Cosmic Sin"
},
{
    "id": 675445,
    "poster": "/ic0intvXZSfBlYPIvWXpU1ivUCO.jpg",
    "genres": [
        "Animation",
        "Family",
        "Adventure",
        "Comedy"
    ],
    "lang": "en",
    "release_date": "2021-08-09",
    "title": "PAW Patrol: The Movie"
}
];

const moviesEl = document.getElementsByClassName('films')[0];
const watchlistEl = document.getElementsByClassName('watch')[0];
const sidebarEl = document.getElementsByClassName('sidebar')[0];
const searchEl = document.getElementsByClassName('search__input')[0];

function creatFilmsToIndex(el) {
    let movieEl = document.createElement('div');
    movieEl.className = 'movie';
    movieEl.innerHTML = `
    <img src="img${el.poster}" class="movie__poster">
    <div class="movie__info">
        <h2 class="movie__title">${el.title}</h2>
        <h3 class="movie__genre">${el.genres}</h3>
        <button class="movie__btn" type="button" data-id="${el.id}">Add to watchlist</button>
    </div>
    `;

    return movieEl;
};

function appendFilms() {
    movies.forEach((el) => {
        moviesEl.appendChild(creatFilmsToIndex(el));
    });
};

if(moviesEl) {
    appendFilms();
};

function filterFilmsByGenre(genre) {
    return movies.filter((el) => {
        return el.genres.includes(genre);
    });
};

if(sidebarEl) {
    sidebarEl.addEventListener('click', function(event) {
        if(event.target.className == 'genre__item') {
            let genreName = event.target.innerText;
            let selectedFilms;
            if(genreName !== 'All') {
                selectedFilms = filterFilmsByGenre(genreName);
                
            } else {
                selectedFilms = movies;
            }
            appendSelectedFilms(selectedFilms);
        };
    });
};

function appendSelectedFilms(el) {
    moviesEl.innerHTML = '';
    el.forEach((el) => {
        moviesEl.appendChild(creatFilmsToIndex(el));
    });
};

// Search

function search(searchText) {
    return movies.filter((el) => {
        return el.title.toLocaleLowerCase().includes(searchText);
    });
};

searchEl.addEventListener('keyup', function() {
    appendSelectedFilms(search(searchEl.value));
});

// Watchlist

let watchlist = JSON.parse(localStorage.getItem('watchlist')) ? JSON.parse(localStorage.getItem('watchlist')) : [];

function addFilmsToWatchlist(filmId) {
    if(!watchlist.includes(filmId)) {
        watchlist.push(filmId);
        localStorage.setItem('watchlist', JSON.stringify(watchlist));
    };
};

if(moviesEl) {
    moviesEl.addEventListener('click', function(event) {
        if(event.target.className == 'movie__btn') {
            let btnId = +event.target.getAttribute('data-id');
            addFilmsToWatchlist(btnId)
        };
    });
};

function createFilmsToWatchlist(el) {
    let filmEl = document.createElement('div');
    filmEl.className = 'movie';
    filmEl.innerHTML = `
    <img src="img${el.poster}" class="movie__poster">
    <div class="movie__info">
        <h2 class="movie__title">${el.title}</h2>
        <h3 class="movie__genre">${el.genres}</h3>
        <button class="movie__btn remove" type="button" data-id="${el.id}">Remove from watchlist</button>
    </div>
    `;

    return filmEl;
};

if(watchlistEl) {
    showWatchlist()
};

function showWatchlist() {
    watchlist.forEach((el) => {
        let item = movies.filter((film) => {
            return film.id == el;
        });
        watchlistEl.appendChild(createFilmsToWatchlist(item[0]));
    });
};

if(watchlistEl) {
    watchlistEl.addEventListener('click', function(event) {
        if(event.target.className == 'movie__btn remove') {
            let elId = +event.target.getAttribute('data-id');

            watchlist.splice(watchlist.indexOf(elId), 1);
            localStorage.setItem('watchlist', JSON.stringify(watchlist));

            let parent = event.target.closest('.movie');
            watchlistEl.removeChild(parent);
        };
    });
};